{% extends "templates/base_page.html" %}

{% from "components/panel/_macro.njk" import onsPanel %}
{% from "components/table-of-contents/_macro.njk" import onsTableOfContents %}
{% from "components/text-indent/_macro.njk" import onsTextIndent %}

{% block header_area %}
    <div class="analysis-header">
        <div class="ons-container">
            {% include "templates/components/navigation/breadcrumbs.html" %}
            <p class="analysis-header__doc-type">{{ _("Analysis") }}</p>

            <div class="ons-grid ons-grid-flex-gap">
                <div class="ons-grid__col ons-col-10@m ">
                    <h1 class="ons-u-fs-3xl analysis-header__heading">
                        {{ page.display_title }}
                    </h1>

                    <p class="analysis-header__summary">{{ page.summary|richtext() }}</p>
                </div>
                <div class="ons-grid__col ons-col-2@m analysis-header__kitemark">
                    {% if page.is_accredited %}
                        {% include "templates/components/accredited/accredited-logo.html" %}
                    {% endif %}
                </div>
            </div>
        </div>

        {% block release_meta %}
            <div class="ons-container">
                {% if page.is_census %}
                    {% include "templates/components/census/census-logo.html" %}
                {% endif %}
                <div class="ons-grid ons-grid-flex-gap ons-grid-flex-gap--40 analysis-header__releases">
                    <div class="ons-grid__col ons-col-4@m">
                        <span class="ons-u-fs-r--b analysis-header__releases-label">{{ _("Release date") }}:</span>
                        <span class="ons-u-nowrap">{{ page.release_date|date("DATE_FORMAT") }}</span>
                    </div>
                    <div class="ons-grid__col ons-col-4@m">
                        <span class="ons-u-fs-r--b analysis-header__releases-label">{{ _("Edition") }}:</span>
                        <span class="ons-u-nowrap">{{ _("Latest") }}</span>
                    </div>
                    <div class="ons-grid__col ons-col-4@m">
                        {% if page.contact_details %}
                            <span class="ons-u-fs-r--b analysis-header__releases-label">{{ _("Contact") }}:</span>
                            <a href="mailto:{{ page.contact_details.email }}">{{ page.contact_details.name }}</a>
                        {% endif %}
                    </div>
                </div>
                <div class="ons-grid ons-grid-flex-gap ons-grid-flex-gap--40 analysis-header__releases">
                    <div class="ons-grid__col ons-col-4@m">
                        <span class="ons-u-fs-r--b analysis-header__releases-label">{{ _("Next release") }}:</span>
                        <span class="ons-u-nowrap">{{ page.next_release_date|date("DATE_FORMAT") or _("To be announced") }}</span>
                    </div>
                    <div class="ons-grid__col ons-col-4@m"></div>
                </div>
            </div>
        {% endblock %}
    </div>

    {% if page.headline_figures %}
        {% include_block page.headline_figures %}
    {% endif %}

    {{ super() }}

{% endblock %}

{% block main %}
    <div class="ons-container">
        <div class="ons-grid ons-grid-flex-gap ons-grid-flex-gap--32">
            <div class="ons-grid__col ons-grid__col--sticky@m ons-col-4@m">
                {% with toc_title=_("Contents"), toc_aria_label=_("Sections in this page") %}
                    {# fmt:off #}
                    {{-
                        onsTableOfContents({
                            "title": toc_title,
                            "ariaLabel": toc_aria_label,
                            "itemsList": table_of_contents
                        })
                    }}
                    {# fmt:on #}
                {% endwith %}
            </div>

            <div class="ons-grid__col ons-col-8@m">
                {# if there are no contact details on the page, we don't want the last
                streamfield block to have a bottom margin. last_flush is used in stream_block.html #}
                {% if page.contact_details %}
                    {% set last_flush = False %}
                {% else %}
                    {% set last_flush = True %}
                {% endif %}

                {% include_block page.content %}

                {% if page.show_cite_this_page %}
                    <section id="cite-this-page">
                        <h2 class="heading-2">{{ _("Cite this analysis") }}</h2>
                        <p>
                            {% set cite_link %}
                                <a href="{{ fullpageurl(page) }}">{{ page.display_title }}</a>
                            {% endset %}
                            {% trans trimmed release_date=page.release_date|date("DATE_FORMAT"), cite_link=cite_link %}
                                Office for National Statistics (ONS), released {{ release_date }}, ONS website, analysis, {{ cite_link }}
                            {% endtrans %}
                        </p>
                    </section>
                {% endif %}

                {% if page.contact_details %}
                    <section id="contact-details">
                        <h2 class="heading-2">{{ _("Contact details") }}</h2>

                        {% call onsTextIndent() %}
                            <p class="contact-details__line">
                                <strong>Name</strong>: {{ page.contact_details.name }}
                            </p>
                            <p class="contact-details__line">
                                <strong>Email</strong>: <a href="mailto:{{ page.contact_details.email }}">{{ page.contact_details.email }}</a>
                            </p>
                            {% if page.contact_details.phone %}
                                <p class="contact-details__line">
                                    <strong>Telephone</strong>: <a href="tel:{{ page.contact_details.phone | replace(' ','')}}">{{ page.contact_details.phone }}</a>
                                </p>
                            {% endif %}
                        {% endcall %}
                    </section>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    {% if page.has_equations %}
        <script async src="{{ mathjax() }}"></script>
    {% endif %}
    {% if page.has_ons_embed %}
        <script src="{{ static('js/third-party/pym.min.js') }}"></script>
    {% endif %}
{% endblock %}
