{% extends "layout/_template.njk" %}
{% from "components/cookies-banner/_macro.njk" import onsCookiesBanner %}

{% set page_title %}
    {% if current_site and page.pk == current_site.root_page.pk and current_site.site_name %}{{ current_site.site_name }} | {% endif %}{% block title %}{% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title}}{% endif %}{% endblock %}{% block title_suffix %}{% if current_site and page.pk != current_site.root_page.pk and current_site.site_name %} | {{ current_site.site_name }}{% endif %}{% endblock %}
{% endset %}

{# fmt:off #}
{% set languages = languages | default([
    {
        "url": "#",
        "ISOCode": "en",
        "text": "English",
        "current": true
    },
    {
        "url": "#",
        "ISOCode": "cy",
        "text": "Cymraeg",
        "current": false
    }
])
%}

{% set pageConfig = {
    "header": {
        "title": page_title,
        "phase": {
            "badge": 'Beta',
            "html": 'This is a new service.'
        },
        "language": {
            "languages": languages
        }
    },
    "footer": {
        "rows": [
            {
                "itemsList": [
                    {
                        "text": 'Contact us',
                        "url": '#0'
                    },
                    {
                        "text": 'Cookies and privacy',
                        "url": '#0'
                    }
                ]
            }
        ],
        "OGLLink": {
            "pre": 'All content is available under the',
            "link": 'Open Government Licence v3.0',
            "url": 'https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/',
            "post": ', except where otherwise stated'
        }
    }
}
%}

{# fmt:on #}
{% block head %}
    <link rel="stylesheet" href="{{ static('css/main.css') }}">

  <!-- Google Tag Manager -->
    <script>

        function loadGTM(){
            (function(w,d,s,l,i){
                w[l]=w[l]||[];
                w[l].push({
                    'gtm.start': new Date().getTime(),
                    event:'gtm.js'
                });
                var f=d.getElementsByTagName(s)[0],
                    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
                j.async=true;
                j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                f.parentNode.insertBefore(j,f);
            })
            (window,document,'script','dataLayer', "{{ GOOGLE_TAG_MANAGER_CONTAINER_ID }}");
        }

        function isUsageCookieAllowed(){
            var re = /^(.*)?\s*'usage':true\s*[^;]+(.*)?$/;
            return document.cookie.match(re);
        }

        if (isUsageCookieAllowed()) {
            loadGTM();
        }
    </script>
  <!-- End Google Tag Manager -->

{% endblock  %}


{% block bodyStart %}
  <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id={{ GOOGLE_TAG_MANAGER_CONTAINER_ID }}"
                height="0" width="0" style="display:none;visibility:hidden">
        </iframe>
    </noscript>
  <!-- End Google Tag Manager (noscript) -->
{% endblock  %}


{% block preMain %}
    {% if not IS_EXTERNAL_ENV %}
        {{ wagtailuserbar() }}
    {% endif %}
{% endblock %}

{% block scripts %}
    <script src="{{ static('js/main.js') }}"></script>
{% endblock %}

{% block preHeader %}
    {#
      NOTE:
      the "settingsLinkTextURL" setting currently doesn't match what's in the guidelines
      that's because we're on version 70.0.17 and it has been renamed to "settingsLinkUrl" in 72.0.0
      See: https://github.com/ONSdigital/design-system/pull/3300
    #}
    {{
    onsCookiesBanner({
    'lang': "cy" if LANGUAGE_CODE == "cy" else "en",
    'serviceName': COOKIE_BANNER_SERVICE_NAME,
    'settingsLinkText': 'Manage settings',
    'settingsLinkTextURL': MANAGE_COOKIE_SETTINGS_URL,
    })
    }}

{% endblock %}
