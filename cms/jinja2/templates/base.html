{% extends "layout/_template.njk" %}
{% from "components/cookies-banner/_macro.njk" import onsCookiesBanner %}

{% set page_title %}
    {% if current_site and page.pk == current_site.root_page.pk and current_site.site_name %}{{ current_site.site_name }} | {% endif %}{% block title %}{% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title}}{% endif %}{% endblock %}{% block title_suffix %}{% if current_site and page.pk != current_site.root_page.pk and current_site.site_name %} | {{ current_site.site_name }}{% endif %}{% endblock %}
{% endset %}

{# fmt:off #}
{% set languages = languages | default([
    {
        "url": "#",
        "isoCode": "en",
        "text": "English",
        "current": true
    },
    {
        "url": "#",
        "isoCode": "cy",
        "text": "Cymraeg",
        "current": false
    }
])
%}

{% set pageConfig = {
    "header": {
        "title": page_title,
        "phase": {
            "badge": 'Beta',
            "html": 'This is a new service.'
        },
        "language": {
            "languages": languages
        }
    },
    "footer": {
        "rows": [
            {
                "itemsList": [
                    {
                        "text": 'Contact us',
                        "url": '#0'
                    },
                    {
                        "text": 'Cookies and privacy',
                        "url": '#0'
                    }
                ]
            }
        ],
        "oglLink": {
            "pre": 'All content is available under the',
            "text": 'Open Government Licence v3.0',
            "url": 'https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/',
            "post": ', except where otherwise stated'
        }
    }
}
%}

{# fmt:on #}
{% block head %}
    <link rel="stylesheet" href="{{ static ('css/main.css') }}">

    {% if GOOGLE_TAG_MANAGER_CONTAINER_ID and not request.is_preview %}
        <script>
            function loadGTM(){
                (function(w,d,s,l,i){
                    w[l]=w[l]||[];
                    w[l].push({
                        'gtm.start': new Date().getTime(),
                        event:'gtm.js'
                    });
                    var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
                    j.async=true;
                    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                    f.parentNode.insertBefore(j,f);
                })
                (window,document,'script','dataLayer', "{{ GOOGLE_TAG_MANAGER_CONTAINER_ID|escape }}");
            }

            function isUsageCookieAllowed(){
                var re = /^(.*)?\s*'usage':true\s*[^;]+(.*)?$/;
                return document.cookie.match(re);
            }

            if (isUsageCookieAllowed()) {
                loadGTM();
            }
        </script>
    {% endif %}

{% endblock  %}


{% block preMain %}
    {% if not IS_EXTERNAL_ENV %}
        {{ wagtailuserbar() }}
    {% endif %}
{% endblock %}

{% block scripts %}
    <script src="{{ static('js/main.js') }}"></script>
{% endblock %}

{% block preHeader %}

  {# fmt:off #}
  {{
    onsCookiesBanner({
      'lang': "cy" if LANGUAGE_CODE == "cy" else "en",
      'serviceName': COOKIE_BANNER_SERVICE_NAME,
      'settingsLinkURL': MANAGE_COOKIE_SETTINGS_URL,
    })
  }}
  {# fmt:on #}

{% endblock %}
